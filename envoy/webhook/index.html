<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=html><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.138.0"><meta name=generator content="Relearn 7.2.1"><meta name=description content="Handling incoming messages with webhooks"><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Webhook Guide :: TRISA Documentation"><meta name=twitter:description content="Handling incoming messages with webhooks"><meta property="og:url" content="https://trisa.dev/envoy/webhook/index.html"><meta property="og:site_name" content="TRISA Documentation"><meta property="og:title" content="Webhook Guide :: TRISA Documentation"><meta property="og:description" content="Handling incoming messages with webhooks"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="TRISA Envoy"><meta property="article:published_time" content="2024-08-11T10:52:58-05:00"><meta property="article:modified_time" content="2024-08-11T10:52:58-05:00"><meta itemprop=name content="Webhook Guide :: TRISA Documentation"><meta itemprop=description content="Handling incoming messages with webhooks"><meta itemprop=datePublished content="2024-08-11T10:52:58-05:00"><meta itemprop=dateModified content="2024-08-11T10:52:58-05:00"><meta itemprop=wordCount content="2459"><title>Webhook Guide :: TRISA Documentation</title><link rel=icon href=/favicon.png type=image/png>
<link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/auto-complete.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/auto-complete.css rel=stylesheet></noscript><link href=/css/perfect-scrollbar.min.css rel=stylesheet><link href=/css/theme.min.css rel=stylesheet><link href=/css/format-html.min.css rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../..",window.relearn.relBaseUri="../..",window.relearn.absBaseUri="https://trisa.dev",window.relearn.min=`.min`,window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.themevariants=["blue"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}}))},window.relearn.markVariant=function(){var t=window.localStorage.getItem(window.relearn.absBaseUri+"/variant"),e=document.querySelector("#R-select-variant");e&&(e.value=t)},window.relearn.initVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant(),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link rel=stylesheet href=/css/syntax.css></head><body class="mobile-support html disableInlineCopyToClipboard" data-url=/envoy/webhook/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><a href=#webhook-request>Webhook Request</a></li><li><a href=#webhook-reply>Webhook Reply</a></li><li><a href=#api-objects>API Objects</a><ul><li><a href=#error>Error</a></li><li><a href=#payload>Payload</a></li><li><a href=#counterparty>Counterparty</a></li></ul></li><li><a href=#authentication>Authentication</a><ul><li><a href=#mtls>mTLS</a></li><li><a href=#hmac-shared-secret>HMAC Shared Secret</a></li></ul></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/index.html><span itemprop=name>TRISA Developer Documentation</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/envoy/index.html><span itemprop=name>TRISA Envoy</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Webhook Guide</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/envoy/api/index.html title="API Guide (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/envoy/support.end/index.html title="Envoy Support (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable envoy" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=webhook-guide>Webhook Guide</h1><details open class="box cstyle notices tip"><summary class=box-label><i class="fa-fw fas fa-anchor"></i>
Enabling the Webhook</summary><div class=box-content><p>To enable the Envoy webhook, you must first specify a webhook endpoint using the <code>$TRISA_WEBHOOK_URL</code> as specified in the <a href=/envoy/configuration/index.html#configuration-values>&ldquo;configuration values&rdquo;</a>. This URL should be available for HTTP POST requests from the Envoy node. If this value is not specified, Envoy will not make any webhook callbacks.</p></div></details><p>When Envoy receives an incoming travel rule message from a remote counterparty it must return a response to that request (for both TRP and TRISA requests). Envoy may handle the request automatically using accept/reject policies or it may simply send a pending message back as the default response. Envoy also supports handling incoming messages by using a webhook callback for another compliance system to determine handling.</p><p>When the webhook is enabled, on every incoming travel rule message Envoy will:</p><ol><li>Decrypt the message (returning an error if decryption is unsuccessful)</li><li>Validate the message (returning an error if the message is invalid)</li><li>Make an http POST request to your webhook with the decrypted message as JSON</li><li>Validate the JSON response from the webhook</li><li>Encrypt the outgoing message and send back to the recipient</li><li>Store the secure envelopes locally</li></ol><p>The webhook will make an POST request to your endpoint supplying the data descrbed in the webhook request in JSON format. Envoy expects a status code 200 response from your endpoint with a reply in UTF-8 encoded JSON.</p><p>A couple of important things to note:</p><ul><li>You must provide a valid response back to Envoy or an error will be returned to the counterparty and logged on the server.</li><li>If the webhook is unavailable, Envoy will return service unavailable to the counterparty.</li><li>Envoy has a request timeout of 30 seconds, however the counterparty may have a shorter duration timeout; if this is the case the request will be canceled.</li></ul><h2 id=webhook-request>Webhook Request</h2><p>The webhook POST request will contain some metadata about the incoming secure envelope, the counterparty, and will contain <em>one of</em> an <code>error</code> or a <code>payload</code> as follows:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;transaction_id&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;counterparty&#34;</span><span class=p>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;hmac_signature&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;public _key_signature&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;transfer_state&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;payload&#34;</span><span class=p>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>transaction_id</td><td>uuid</td><td>the id of both the Envoy transaction and the secure envelope id</td></tr><tr><td>timestamp</td><td>timestamp</td><td>the RFC3339Nano timestamp of the secure envelope</td></tr><tr><td>counterparty</td><td>object</td><td>the information about the counterparty that Envoy has in its database</td></tr><tr><td>hmac_signature</td><td>base64</td><td>if the secure envelope has a valid hmac_signature, this is the base64 encoded signature (omitted if not set)</td></tr><tr><td>public_key_signature</td><td>string</td><td>used to identify the public keys that sealed the incoming secure envelope (omitted if not set)</td></tr><tr><td>transfer_state</td><td>string</td><td>the TRISA transfer state of the secure envelope</td></tr><tr><td>error</td><td>object</td><td>if the incoming envelope is a rejection or repair request the error will be set (omitted if payload is set)</td></tr><tr><td>payload</td><td>object</td><td>if the incoming envelope contains a travel rule information payload, this will be the decrypted info (omitted if error is set)</td></tr></tbody></table><p>Details of the <code>counterparty</code>, <code>error</code>, and <code>payload</code> objects are described below.</p><h2 id=webhook-reply>Webhook Reply</h2><p>The reply to the POST request must have a 200 status code and the following data serialized as UTF-8 encoded JSON. Note that either the <code>error</code> field or the <code>payload</code> field may be specified <em>but not both</em>.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;transaction_id&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;payload&#34;</span><span class=p>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;transfer_action&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>transaction_id</td><td>uuid</td><td>the transaction_id must match the transaction_id of the request</td></tr><tr><td>error</td><td>object</td><td>if you&rsquo;re rejection or requesting a repair, specify the details in this field (must be omitted if payload is set)</td></tr><tr><td>payload</td><td>object</td><td>the payload to return to the counterparty (may simply be an echo of the original payload) (must be omitted if error is set)</td></tr><tr><td>transfer_action</td><td>string</td><td>the TRISA transfer action you&rsquo;d like specified in the reply to the counterparty (see below for values)</td></tr></tbody></table><p>If the <code>transaction_id</code> does not match the ID of the request, then Envoy will fail and return an error to the counterparty.</p><p>The <code>transfer_action</code> can be one of &ldquo;PENDING&rdquo;, &ldquo;REVIEW&rdquo;, &ldquo;REPAIR&rdquo;, &ldquo;ACCEPTED&rdquo;, &ldquo;REJECTED&rdquo;, or &ldquo;COMPLETED&rdquo;. See <a href=/api/workflows/index.html>TRISA workflows</a> for more about how these states determine responses to incoming messages. A basic summary is as follows:</p><p>Use <code>"PENDING"</code> if a compliance officer on your team needs to review the travel rule request, make sure you include a <code>pending</code> and <code>identity</code> in your reply.</p><p>Use <code>"REVIEW"</code> if the counterparty&rsquo;s compliance officer needs to review the travel rule request, make sure you include a <code>transaction</code> and <code>identity</code> in your reply. This is generally used if you&rsquo;ve made changes to the original payload.</p><p>Use <code>"REPAIR"</code> if you need the counterparty to make a change to the payload, e.g. if it is missing fields required for your jurisdiction, make sure you&rsquo;ve included an <code>error</code> in your reply that describes the changes that need to be made.</p><p>Use <code>"ACCEPTED"</code> if you&rsquo;re ready for the counterparty to make the on-chain transaction and you&rsquo;re satisfied with the compliance exchange. Make sure to echo back the <code>transaction</code> and <code>identity</code> in your reply.</p><p>Use <code>"REJECTED"</code> if you do not want the counterparty to proceed with the on-chain transaction; make sure to include the <code>error</code> in your reply with the rejection information.</p><p>Use <code>"COMPLETED"</code> if the compliance exchange is accepted <em>and</em> the on-chain transaction has already been conducted and the payload contains a proper, chain-specific transaction ID in the payload. Make sure you echo back the <code>transaction</code> and <code>identity</code> in your reply.</p><h2 id=api-objects>API Objects</h2><p>This section describes nested objects in the request and reply.</p><h3 id=error>Error</h3><p>Errors are mutually exclusive with payloads, meaning a response or reply to the webhook will have either an <code>error</code> field or a <code>payload</code> field but should not have both.</p><p>An error describes either a <em>repair</em> or a <em>rejection</em> (determined by the <code>retry</code> boolean flag). A rejection (<code>retry=false</code>) implies that the counterparty should stop the on-chain transaction as the compliance exchange has not been satisfied. A repair (<code>retry=true</code>) implies that the counterparty needs to amend the identity payload, e.g. because there are missing fields that are required for compliance in your jurisdiction.</p><p>The fields for the error are as follows:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;code&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;retry&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>code</td><td>int32</td><td>the error code from the TRISA api package</td></tr><tr><td>message</td><td>string</td><td>a detailed message about why the request is being rejected or what needs to be repaired</td></tr><tr><td>retry</td><td>bool</td><td>should be false if this is a rejection, true if a repair is being requested</td></tr></tbody></table><p>View the available <a href=/api/errors/index.html>error codes in the TRISA API docs</a>.</p><h3 id=payload>Payload</h3><p>Payloads are mutually exclusive with errors, meaning a response or reply to the webhook will have either a <code>payload</code> field or an <code>error</code> field but should not have both.</p><p>Additionally, payloads have mutually exclusive fields <code>pending</code> and <code>transaction</code> - a payload can have one or the other, but not both.</p><p>The payload fields are as follows:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;identity&#34;</span><span class=p>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;pending&#34;</span><span class=p>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;transaction&#34;</span><span class=p>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;sent_at&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;received_at&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>identity</td><td>object</td><td>an IVMS101 payload, see IVMS101 docs for more information</td></tr><tr><td>pending</td><td>object</td><td>a TRISA pending message, see TRISA docs for more information</td></tr><tr><td>transaction</td><td>object</td><td>a TRISA generic transaction, see TRISA docs for more information</td></tr><tr><td>sent_at</td><td>string</td><td>the RFC3339 encoded timestamp of when the compliance exchange was initiated</td></tr><tr><td>received_at</td><td>string</td><td>the RFC3339 encoded timestamp of when the compliance exchange was approved by the counterparty</td></tr></tbody></table><p>For more information about IVMS101, please see: <a href=/data/ivms/index.html>Working with IVMS101</a>.</p><p>For more information about the pending and transaction generic payloads, please see: <a href=/data/payloads/index.html>TRISA Data Payloads</a>.</p><h3 id=counterparty>Counterparty</h3><p>The counterparty describes what the Envoy node knows about the remote counterparty. This information may be more complete if the counterparty record was created by the TRISA directory service or stored locally on the node. If the record was created by a TRP record, this information may be fairly sparse.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;source&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;directory_id&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;registered_directory&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;protocol&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;common_name&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;endpoint&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;travel_address&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;website&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;country&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;business_category&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;vasp_categories&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;verified_on&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ivms101&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;created&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;modified&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>id</td><td>ulid</td><td>the Envoy id of the counterparty for api lookups</td></tr><tr><td>source</td><td>string</td><td>the source of the counterparty info (e.g. user, gds, x509)</td></tr><tr><td>directory_id</td><td>uuid</td><td>the id of the counterparty in the TRISA directory</td></tr><tr><td>registered_directory</td><td>string</td><td>the id of the directory the counterparty is listed in</td></tr><tr><td>protocol</td><td>string</td><td>the preferred protocol of the counterparty (trp or trisa)</td></tr><tr><td>common_name</td><td>string</td><td>the common name associated with the counterparty&rsquo;s certificates</td></tr><tr><td>endpoint</td><td>string</td><td>the uri endpoint of the counterparty to send travel rule requests</td></tr><tr><td>travel_address</td><td>string</td><td>a travel address identifying the generic endpoint of the counterparty</td></tr><tr><td>name</td><td>string</td><td>the display name of the counterparty</td></tr><tr><td>website</td><td>string</td><td>the website of the counterparty</td></tr><tr><td>country</td><td>string</td><td>the alpha-2 country code of the counterparty</td></tr><tr><td>business_category</td><td>string</td><td>the business category of the counterparty (e.g. private, government, etc)</td></tr><tr><td>vasp_categories</td><td>[]string</td><td>the type of virtual asset services the counterparty provides (e.g. Exchange or Miner)</td></tr><tr><td>verified_on</td><td>string</td><td>the RFC3339 timestamp of when the counterparty was verified by the TRISA network</td></tr><tr><td>ivms101</td><td>IVMS 101</td><td>the ivms101 record of the legal person representing the counterparty</td></tr><tr><td>created</td><td>string</td><td>the RFC3339nano timestamp of when the counterparty was added to your Envoy node</td></tr><tr><td>modified</td><td>string</td><td>the RFC3339nano timestamp of when the counterparty was lasted modified on your Envoy node</td></tr></tbody></table><h2 id=authentication>Authentication</h2><p>Webhook requests can be authenticated in two ways:</p><ol><li>mTLS using non-TRISA certificates</li><li>HMAC signature verification with a shared secret</li></ol><p>Either of these options or both (or neither) can be used!</p><h3 id=mtls>mTLS</h3><p>To configure mTLS on the webhook client; you&rsquo;ll need to specify the following configuration values:</p><ul><li><code>$TRISA_WEBHOOK_USE_MTLS</code> should be set to <code>"true"</code>.</li><li><code>$TRISA_WEBHOOK_CERTS</code> should point to the path of the mTLS client certificate and private key.</li><li><code>$TRISA_WEBHOOK_POOL</code> should point to an x509 certificate authority pool for the certs.</li></ul><p>Note that if <code>$TRISA_WEBHOOK_CERTS</code> and <code>$TRISA_WEBHOOK_POOL</code> are unset and <code>$TRISA_WEBHOOK_USE_MTLS</code> is <code>"true"</code> then by default your TRISA certificates are used as the client certificates for the webhook call. You can obtain TRISA certificates for your webhook server by requesting them using the GDS service.</p><h3 id=hmac-shared-secret>HMAC Shared Secret</h3><p>Simple, cryptographic authentication for webhook requests can performed with a shared secret using a mechanism similar to <a href=https://mohawk.readthedocs.io/en/latest/usage.html#sending-a-request rel=external target=_blank>Hawk</a> and <a href=https://docs.aws.amazon.com/AmazonS3/latest/API/sigv4-auth-using-authorization-header.html rel=external target=_blank>AWS4 HMAC-256</a>. This method adds authentication variables to the HTTP request in the <code>Authorization</code> header including a cryptographically signed HMAC that can be used to verify both the client and the server.</p><p>The following is an example of the <code>Authorization</code> header value. Line breaks are added to this example for readibility:</p><div class="highlight wrap-code"><pre tabindex=0><code>Authorization: HMAC
sig=zFeIxdyVnJtpMUExK7HoL37VN4tF6sMQZPEr58MBpMQ,
nonce=wm0eHegl4lD0Uw_sSYYQCw,
headers=x-transfer-id,x-transfer-timestamp
kid=01JT4B3R5Z6AHJXV87QHPPKRBM</code></pre></div><p>The following table describes the various components of the <code>Authorization</code> header value in the preceding example:</p><table><thead><tr><th>Component</th><th>Description</th></tr></thead><tbody><tr><td>HMAC</td><td>The authentication scheme being used; indicates that this is an Envoy HMAC-256 signed header.</td></tr><tr><td>sig</td><td>A 32 byte HMAC signature using a SHA-256 hash and a secret key. The signature is expressed as base64 encoded characters.</td></tr><tr><td>nonce</td><td>16 cryptographically random bytes expressed as base64 encoded characters. The nonce helps prevent reply attacks by adding random data to the signature.</td></tr><tr><td>headers</td><td>A semicolon-separated, ordered list of request headers used to compute the signature. The list includes header names only, and the header names must be in lowercase.</td></tr><tr><td>kid</td><td>The ID (usually a ULID) that identifies the secret key being used to compute the signature.</td></tr></tbody></table><p>If the webhook is configured with HMAC authentication, then it will send the signed header with every webhook request. It is up to the webhook server to verify the HMAC token (or not) and to respond with a 401 status code if the token is not verified.</p><p>Additionally, server authentication is optionally available that requires the server to add a response header, <code>Server-Authorization</code> with a reciprocal HMAC code and a <em>new</em> nonce using the same shared key. If this option is configured, the webhook client will require a verified token before accepting a response from the webhook.</p><details open class="box cstyle notices orange"><summary class=box-label><i class="fa-fw fas fa-lock"></i>
Use TLS</summary><div class=box-content><p>Even if HMAC shared secret authorization is used, it is strongly recommended that TLS is used to secure and encrypt the connection between the webhook client and server.</p></div></details><h4 id=verification>Verification</h4><p>In order to verify the <code>Authorization</code> header, the following steps are required:</p><ol><li><p>Parse the value of the <code>Authorization</code> header.</p><ul><li>If the header does not contain an <code>HMAC </code>prefix, then it is invalid; otherwise strip this prefix.</li><li>Split the remaining header by <code>,</code> and trim any whitespace from the front or back of the split strings.</li><li>Create key/value pairs by splitting each part of the header on <code>=</code> using a splitn algorithm that allows at most two parts (e.g. split on the first <code>=</code>). The key is the left side and the value is the right side.</li><li>Ensure that <code>sig</code>, <code>nonce</code>, <code>headers</code>, and <code>kid</code> are present in the keys and contain values; any other key value pairs can be ignored.</li><li>An example of parsing code in GoLang can be found <a href=https://github.com/trisacrypto/envoy/blob/main/pkg/webhook/auth.go#L110-L168 rel=external target=_blank>here</a>.</li></ul></li><li><p>Create a byte array of data to be signed.</p><ul><li>The beginning of the array is the base64 decoded <code>nonce</code> value.</li><li>Split the <code>headers</code> value by <code>,</code> and then for each header in the order specified, append the utf-8 bytes of the unmodified header value to the data array.</li></ul></li><li><p>Sign the data using the key identified by the key id.</p><ul><li>Use the Key ID to identify the shared secret</li><li>Use HMAC with SHA-256 hashing to create a signed token of the data</li></ul></li><li><p>Compare the bytes of the signed data with the signature.</p><ul><li>Base64 decode the <code>sig</code> value</li><li>Ensure the bytes of <code>sig</code> are qual to the bytes of the constructed signature.</li></ul></li></ol><h4 id=base64-encoding>Base64 Encoding</h4><p>The <a href=https://developer.mozilla.org/en-US/docs/Glossary/Base64 rel=external target=_blank>Base64 encoding method</a> used is the URL-safe base64 encoding method that replaces <code>+/</code> with <code>-_</code> and does not use <code>=</code> padding characters to ensure that it does not interfere with the HTTP headers.</p><h4 id=signing-a-response>Signing a Response</h4><p>You can optionally configure the Envoy webhook client to verify the response sent back from your server with the same shared secret.</p><p>To create the authorization key:</p><ol><li>Generate a random 16 byte nonce</li><li>Select headers and append their UTF-8 bytes to the nonce</li><li>Use the secret key to create an HMAC with SHA-256 hash</li><li>Base64 encode the HMAC sum and the nonce</li></ol><p>Create a <code>Server-Authorization</code> header using the signature, nonce, comma-separated lower case headers, and the keyID and send back as part of the reply.</p><h4 id=configuration>Configuration</h4><p>In order to configure HMAC authentication you need to set the following environment variables:</p><ol><li><code>$TRISA_WEBHOOK_AUTH_KEY_ID</code>: the ULID representing the key for key management purposes; if set the auth key secret must also be set.</li><li><code>$TRISA_WEBHOOK_AUTH_KEY_SECRET</code>: the <em>hexadecimal</em> encoded 32 byte secret used for securing the HMAC token; if set the auth key id must also be set.</li></ol><p>You can generate a key ID and secret with:</p><div class="highlight wrap-code"><pre tabindex=0><code>$ envoy hmackey</code></pre></div><p>Optionally, to require server authentication (which is not enforced by default) you can set <code>$TRISA_WEBHOOK_REQUIRE_SERVER_AUTH</code> to <code>"true"</code>; this will cause the webhook client to verify the <code>Server-Authorization</code> header before accepting the response.</p><p>Note that all of the configuration values above require <code>$TRISA_WEBHOOK_URL</code> to be set, which enables webhook usage; otherwise the configuration is ignored.</p><p>See the <a href=/envoy/configuration/index.html#configuration-values>&ldquo;configuration values&rdquo;</a> section for more on configuring Envoy from the environment.</p><footer class=footline></footer></article></div></main></div><aside id=R-sidebar class=default-animation><div id=R-header-topbar class=default-animation></div><div id=R-header-wrapper class=default-animation><div id=R-header class=default-animation><a id=logo href=/ style="color:#3d414d;font-family:novacento sans wide,helvetica,tahoma,geneva,arial,sans-serif;font-size:30px;font-weight:700;margin-top:-2px"><svg version="1.0" width="110pt" height="100pt" viewBox="0 0 1116 1022"><g transform="translate(0.000000,1022.000000) scale(0.100000,-0.100000)" fill="#fff" stroke="none"><path d="M5175 8694c-372-40-646-124-955-289-93-50-98-53-185-109-79-52-172-124-270-211l-80-71-45 8c-119 24-255-17-338-1e2-138-139-147-353-21-513 96-123 314-160 462-81 67 36 141 120 166 187 29 76 29 214 1 280l-20 46 53 50c28 27 93 80 142 118 319 239 7e2 388 1106 431 123 13 410 13 524 0 455-52 915-256 1233-547l53-48-20-60c-10-33-22-71-25-85-4-21-24-33-121-74-514-217-929-608-1212-1141l-53-1e2v457 456l48 27c108 62 171 149 192 264 30 169-51 336-199 408-51 25-66 28-166 28-106 0-112-1-171-33-75-41-123-89-160-162-27-51-29-63-29-170s2-119 28-168c33-63 101-131 163-163l44-24v-841-841l-40-18c-52-24-145-121-172-182-17-38-21-68-22-148-1-88 2-107 26-157 83-177 275-258 466-196 58 18 77 31 138 92s73 79 87 132c33 119 16 254-44 341-29 42-94 1e2-137 122-12 7-20 16-17 21 3 4 12 46 21 92 24 130 72 290 126 428 43 108 204 408 250 465 4 6 34 44 65 85 242 316 561 565 903 704l64 26 41-39c22-22 67-53 1e2-68 53-25 71-28 160-28 91 0 106 3 158 30 136 68 213 202 205 353-8 147-77 257-2e2 317-61 31-197 45-259 27-35-9-39-8-80 30-24 23-60 55-79 73-29 26-92 75-185 143-5 4-30 20-55 36s-58 38-73 48c-42 29-250 134-305 154-26 10-51 20-57 24-30 20-248 87-363 111-303 65-595 83-867 53z"/><path d="M5901 4195c-67-15-98-31-144-74-84-77-97-212-31-314 45-69 1e2-95 357-168 114-32 150-82 110-150-36-61-165-89-246-55-43 17-84 67-97 117l-11 40-92-7c-51-3-94-8-96-10-8-7 20-111 40-150 66-124 204-185 388-171 213 17 321 115 321 290 0 165-78 239-320 302-175 45-220 73-206 131 20 79 210 94 271 22 14-17 29-44 32-60 5-27 9-29 36-24 16 3 61 6 99 6h70l-7 43c-4 23-14 59-22 80-21 53-104 123-166 142-75 23-209 28-286 10z"/><path d="M3570 4110v-80h135 135v-380-380h1e2 1e2v380 380h135 135v80 80h-370-370v-80z"/><path d="M4420 3731v-461h95 95v190 190h39c107 0 124-14 269-228l103-152h115c62 0 114 2 114 5s-41 69-90 148c-61 95-110 161-151 2e2-47 44-57 57-42 57 34 0 96 30 131 63 126 120 98 339-53 416-49 26-51 26-337 29l-288 4v-461zm5e2 281c25-12 39-28 49-58 13-37 12-44-5-80-10-21-30-44-44-50-14-7-89-15-167-19l-143-7v116 116h138c110 0 144-3 172-18z"/><path d="M5340 3730v-460h95 95v460 460h-95-95v-460z"/><path d="M6792 4138c-11-29-90-233-176-452-86-220-156-404-156-408 0-5 46-7 102-6l103 3 36 1e2 36 1e2h179 178l39-102 40-103h103c57 0 104 3 104 8 0 4-81 211-181 460l-181 452h-103-104l-19-52zm176-328c28-74 53-143 57-152 7-17-2-18-109-18-64 0-116 1-116 3 0 14 112 309 115 305 2-2 26-64 53-138z"/><path d="M9e2 2194v-466l243 4c275 5 316 14 399 88 174 153 186 548 22 730-82 90-163 109-466 110H9e2v-466zm455 277c51-23 91-69 107-124 19-65 16-261-5-323-19-55-56-97-1e2-113-16-6-80-11-143-11h-114v295 295h108c82 0 116-5 147-19z"/><path d="M8290 2575v-85h90 90v85 85h-90-90v-85z"/><path d="M6818 2587l-88-52v-67-68h-40-40v-70-70h39 38l5-212c6-252 13-278 80-308 48-22 140-26 201-9 34 9 37 13 37 47 0 72-11 113-29 108-55-16-69-17-85-1-14 14-16 43-16 196v179h60 60v70 70h-60-60v120c0 66-3 120-7 119-5 0-47-24-95-52z"/><path d="M7958 2587l-88-51v-68-68h-40-40v-70-70h39 39l4-217c3-245 9-268 78-304 40-22 141-26 203-8l39 10-7 72c-4 40-9 74-10 75-2 2-19-1-39-8-26-8-41-8-56 0-19 10-20 19-20 195v185h60 60v70 70h-60-60v120c0 66-3 120-7 120-5-1-47-24-95-53z"/><path d="M2013 2402c-151-54-227-166-227-332 1-206 121-337 320-348 157-9 267 51 334 182 33 64 35 74 35 165-1 82-4 104-26 151-37 79-81 125-156 162-83 41-198 49-280 20zm196-160c61-45 90-128 76-215-10-56-28-89-65-121-61-51-132-47-191 12-91 91-65 289 45 338 39 18 101 11 135-14z"/><path d="M2773 2402c-89-32-143-84-180-173-14-34-18-71-18-164 0-111 2-124 28-177 55-111 153-168 291-168 137 0 220 45 273 148 49 95 48 97-56 114l-89 14-11-36c-15-51-51-81-103-87-94-9-148 64-148 202 0 134 44 195 139 195 46 0 95-35 105-75 4-14 12-25 19-24 27 1 158 27 163 32 10 10-15 73-46 115-44 61-122 95-229 99-65 3-99-1-138-15z"/><path d="M4375 2408c-16-6-48-24-70-40l-40-29-3 31-3 30h-90-89v-335-335h95 95v203c0 111 4 219 9 240 24 102 152 141 191 59 9-18 14-103 18-264l5-238h87 88l4 223c3 189 6 227 21 254 38 70 120 90 163 39 24-27 24-29 24-272v-244h95 95v251c0 287-6 325-60 379-83 83-254 77-338-13l-23-24-37 37c-55 55-158 76-237 48z"/><path d="M5389 2404c-59-18-133-83-164-144s-48-168-39-245c14-127 67-215 158-263 46-25 61-27 161-27s115 2 161 27c70 37 144 128 131 162-3 7-42 18-88 25-78 12-85 12-94-5-26-47-63-74-102-74-68 0-118 45-137 123l-6 27h220 220v58c0 125-48 239-122 293-78 56-2e2 74-299 43zm178-150c29-18 49-51 58-91l7-33h-126-126v25c0 94 108 151 187 99z"/><path d="M6241 2406c-24-8-61-29-82-46l-39-31v36 35h-90-90v-335-335h94 95l3 223c4 258 8 275 84 309 54 23 91 18 125-18 24-25 24-28 27-270l3-244h95 95l-3 268c-3 257-4 269-26 315-33 65-90 99-180 103-40 2-84-2-111-10z"/><path d="M7292 2405c-81-23-130-67-157-144-11-31-11-41-2-41 7 0 45-6 85-14l73-14 15 30c20 40 73 61 129 52 50-7 72-27 81-71 7-35 18-30-156-69-202-46-250-89-250-221 0-42 6-67 25-99 63-107 255-127 371-39l32 24 6-34 7-35h96c87 0 94 2 88 18-30 71-35 115-35 296-1 264-11 298-104 345-62 31-221 39-304 16zm225-416c-4-49-11-67-33-90-69-72-173-58-190 27-10 53 23 74 181 112 22 6 42 10 44 11s1-26-2-60z"/><path d="M8836 2404c-167-53-255-209-226-397 19-127 75-206 180-256 48-23 67-26 160-26 91 0 112 3 155 24 59 30 126 94 154 149 70 138 39 341-68 434-87 77-242 108-355 72zm161-145c102-38 146-212 80-311-87-128-244-90-277 67s75 290 197 244z"/><path d="M9715 2404c-22-8-57-28-77-45l-38-30v36 35h-90-90v-335-335h94 95l3 223c3 257 8 275 83 308 52 23 94 17 127-18 23-24 23-29 26-269l3-244h95 96l-4 268c-3 264-3 268-28 317-20 38-37 55-75 74-60 31-160 38-220 15z"/><path d="M3312 2138c4-292 8-309 71-365 48-42 97-56 176-51 71 5 120 25 164 66l27 26v-42-42h90 90v335 335h-94-95l-3-223c-3-193-5-227-21-250-24-36-59-58-105-64-33-4-44-1-73 25l-34 30-3 241-3 241h-95-96l4-262z"/><path d="M8290 2065v-335h90 90v335 335h-90-90v-335z"/></g></svg></a></div><script>window.index_js_url="/searchindex.en.js"</script><search><form action=/search/index.html method=get><div class="searchbox default-animation"><button class=search-detail type=submit title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
<label class=a11y-only for=R-search-by>Search</label>
<input data-search-input id=R-search-by name=search-by class=search-by type=search placeholder=Search...>
<button class=search-clear type=button data-search-clear title="Clear search"><i class="fas fa-times" title="Clear search"></i></button></div></form></search><script>var contentLangs=["en"]</script><script src=/js/auto-complete.js defer></script><script src=/js/lunr/lunr.min.js defer></script><script src=/js/lunr/lunr.stemmer.support.min.js defer></script><script src=/js/lunr/lunr.multi.min.js defer></script><script src=/js/lunr/lunr.en.min.js defer></script><script src=/js/search.js defer></script></div><div id=R-homelinks class="default-animation homelinks"><ul><li><a class=padding href=/index.html><i class='fas fa-home'></i> Home</a></li></ul><hr class=padding></div><div id=R-content-wrapper class=highlightable><div id=R-shortcutmenu-home class=R-sidebarmenu><ul class="enlarge morespace collapsible-menu"><li data-nav-id=/getting-started/index.html><a class=padding href=/getting-started/index.html>Getting Started</a></li><li data-nav-id=/joining-trisa/index.html><a class=padding href=/joining-trisa/index.html>Joining TRISA</a><ul id=R-subsections-f4415aff61d0d3b92b4fe9375df1003b class=collapsible-menu></ul></li><li class=parent data-nav-id=/envoy/index.html><a class=padding href=/envoy/index.html>TRISA Envoy</a><ul id=R-subsections-37e3aec351bcd85a6ea8b58e3592ef6e class=collapsible-menu><li data-nav-id=/envoy/deploy/index.html><a class=padding href=/envoy/deploy/index.html>Deploying Envoy</a></li><li data-nav-id=/envoy/workflows/index.html><a class=padding href=/envoy/workflows/index.html>Envoy Workflows</a></li><li data-nav-id=/envoy/configuration/index.html><a class=padding href=/envoy/configuration/index.html>Configuration</a></li><li data-nav-id=/envoy/api/index.html><a class=padding href=/envoy/api/index.html>API Guide</a></li><li class=active data-nav-id=/envoy/webhook/index.html><a class=padding href=/envoy/webhook/index.html>Webhook Guide</a></li><li data-nav-id=/envoy/support.end/index.html><a class=padding href=/envoy/support.end/index.html>Envoy Support</a></li><li data-nav-id=/envoy/openapi/index.html><a class=padding href=/envoy/openapi/index.html>API Reference</a></li></ul></li><li data-nav-id=/api/index.html><a class=padding href=/api/index.html>TRISA Protocol and API</a><ul id=R-subsections-944da21c517df0c48dfbef7af28f3093 class=collapsible-menu></ul></li><li data-nav-id=/data/index.html><a class=padding href=/data/index.html>Working with TRISA Data</a><ul id=R-subsections-4caa791091d21d23e63637080226f370 class=collapsible-menu></ul></li><li data-nav-id=/gds/index.html><a class=padding href=/gds/index.html>Global Directory Service</a><ul id=R-subsections-a963069aa96c47bd6033aafd06b6506a class=collapsible-menu></ul></li><li data-nav-id=/testing/index.html><a class=padding href=/testing/index.html>Testing and Deployment</a><ul id=R-subsections-5701246c22a178238adea0dba612ec07 class=collapsible-menu></ul></li><li data-nav-id=/openvasp/index.html><a class=padding href=/openvasp/index.html>OpenVASP/TRP Integration</a><ul id=R-subsections-f49ded5dadfa5db1635b3279703789ed class=collapsible-menu></ul></li><li data-nav-id=/reference/index.html><a class=padding href=/reference/index.html>Reference</a><ul id=R-subsections-66002f201bef818664bb81aa67490c58 class=collapsible-menu></ul></li></ul></div><div id=R-shortcutmenu-shortcuts class=R-sidebarmenu><ul class="space collapsible-menu"><li data-nav-id=https://github.com/trisacrypto/trisa><a class=padding href=https://github.com/trisacrypto/trisa target=_blank><i class='fab fa-fw fa-github'></i> Version v1beta1</a></li><li data-nav-id=https://pkg.go.dev/github.com/trisacrypto/trisa/pkg><a class=padding href=https://pkg.go.dev/github.com/trisacrypto/trisa/pkg target=_blank><i class='fas fa-book'></i> TRISA API Documentation</a></li></ul></div><div class="padding footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showLangSwitch showFooter"></div><div id=R-menu-footer><hr class="padding default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showLangSwitch showFooter"><div id=R-prefooter class="footerLangSwitch footerVariantSwitch footerVisitedLinks showLangSwitch"><ul><li id=R-select-language-container class="footerLangSwitch showLangSwitch"><div class="padding menu-control"><i class="fa-fw fas fa-language"></i>
<span>&nbsp;</span><div class=control-style><label class=a11y-only for=R-select-language>Language</label>
<select id=R-select-language onchange="location=this.querySelector(this.value).dataset.url"><option id=R-select-language-en value=#R-select-language-en data-url=/envoy/webhook/index.html lang=en selected>English</option></select></div><div class=clear></div></div></li><li id=R-select-variant-container class=footerVariantSwitch><div class="padding menu-control"><i class="fa-fw fas fa-paint-brush"></i>
<span>&nbsp;</span><div class=control-style><label class=a11y-only for=R-select-variant>Theme</label>
<select id=R-select-variant onchange=window.relearn.changeVariant(this.value)><option id=R-select-variant-blue value=blue selected>Blue</option></select></div><div class=clear></div></div><script>window.relearn.markVariant()</script></li><li class=footerVisitedLinks><div class="padding menu-control"><i class="fa-fw fas fa-history"></i>
<span>&nbsp;</span><div class=control-style><button onclick=clearHistory()>Clear History</button></div><div class=clear></div></div></li></ul></div><div id=R-footer class="footerFooter showFooter"><p><i class="fa fa-code"></i> <a href=https://github.com/trisacrypto/trisa/blob/main/LICENSE>Open Source Licensed</a> by <a href=https://trisa.io/>TRISA</a></p></div></div></div></aside><script src=/js/clipboard.min.js defer></script><script src=/js/perfect-scrollbar.min.js defer></script><script src=/js/theme.js defer></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-F9T1H8EJJS"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F9T1H8EJJS")</script></body></html>