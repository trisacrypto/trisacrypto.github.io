<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.83.1"><meta name=description content="Using the TRISA command line interface for development"><link rel=icon href=/favicon.png type=image/png><title>TRISA CLI :: TRISA Documentation</title><link href=/css/nucleus.css?1657203542 rel=stylesheet><link href=/css/fontawesome-all.min.css?1657203542 rel=stylesheet><link href=/css/featherlight.min.css?1657203542 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1657203542 rel=stylesheet><link href=/css/auto-complete.css?1657203542 rel=stylesheet><link href=/css/theme.css?1657203542 rel=stylesheet><link href=/css/theme-blue.css?1657203542 rel=stylesheet><link href=/css/variant.css?1657203542 rel=stylesheet><link href=/css/print.css?1657203542 rel=stylesheet media=print><script src=/js/jquery.min.js?1657203542></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}:not(pre)>code+span.copy-to-clipboard{display:none}</style></head><body data-url=/testnet/trisa-cli/><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href=/ style="color:#3d414d;font-family:novacento sans wide,helvetica,tahoma,geneva,arial,sans-serif;font-size:30px;font-weight:700;margin-top:-2px"><svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="110pt" height="100pt" viewBox="0 0 1116 1022"><g transform="translate(0.000000,1022.000000) scale(0.100000,-0.100000)" fill="#fff" stroke="none"><path d="M5175 8694c-372-40-646-124-955-289-93-50-98-53-185-109-79-52-172-124-270-211l-80-71-45 8c-119 24-255-17-338-1e2-138-139-147-353-21-513 96-123 314-160 462-81 67 36 141 120 166 187 29 76 29 214 1 280l-20 46 53 50c28 27 93 80 142 118 319 239 7e2 388 1106 431 123 13 410 13 524 0 455-52 915-256 1233-547l53-48-20-60c-10-33-22-71-25-85-4-21-24-33-121-74-514-217-929-608-1212-1141l-53-1e2v457 456l48 27c108 62 171 149 192 264 30 169-51 336-199 408-51 25-66 28-166 28-106 0-112-1-171-33-75-41-123-89-160-162-27-51-29-63-29-170s2-119 28-168c33-63 101-131 163-163l44-24v-841-841l-40-18c-52-24-145-121-172-182-17-38-21-68-22-148-1-88 2-107 26-157 83-177 275-258 466-196 58 18 77 31 138 92s73 79 87 132c33 119 16 254-44 341-29 42-94 1e2-137 122-12 7-20 16-17 21 3 4 12 46 21 92 24 130 72 290 126 428 43 108 204 408 250 465 4 6 34 44 65 85 242 316 561 565 903 704l64 26 41-39c22-22 67-53 1e2-68 53-25 71-28 160-28 91 0 106 3 158 30 136 68 213 202 205 353-8 147-77 257-2e2 317-61 31-197 45-259 27-35-9-39-8-80 30-24 23-60 55-79 73-29 26-92 75-185 143-5 4-30 20-55 36s-58 38-73 48c-42 29-250 134-305 154-26 10-51 20-57 24-30 20-248 87-363 111-303 65-595 83-867 53z"/><path d="M5901 4195c-67-15-98-31-144-74-84-77-97-212-31-314 45-69 1e2-95 357-168 114-32 150-82 110-150-36-61-165-89-246-55-43 17-84 67-97 117l-11 40-92-7c-51-3-94-8-96-10-8-7 20-111 40-150 66-124 204-185 388-171 213 17 321 115 321 290 0 165-78 239-320 302-175 45-220 73-206 131 20 79 210 94 271 22 14-17 29-44 32-60 5-27 9-29 36-24 16 3 61 6 99 6h70l-7 43c-4 23-14 59-22 80-21 53-104 123-166 142-75 23-209 28-286 10z"/><path d="M3570 4110v-80h135 135v-380-380h1e2 1e2v380 380h135 135v80 80h-370-370v-80z"/><path d="M4420 3731v-461h95 95v190 190h39c107 0 124-14 269-228l103-152h115c62 0 114 2 114 5s-41 69-90 148c-61 95-110 161-151 2e2-47 44-57 57-42 57 34 0 96 30 131 63 126 120 98 339-53 416-49 26-51 26-337 29l-288 4v-461zm5e2 281c25-12 39-28 49-58 13-37 12-44-5-80-10-21-30-44-44-50-14-7-89-15-167-19l-143-7v116 116h138c110 0 144-3 172-18z"/><path d="M5340 3730v-460h95 95v460 460h-95-95v-460z"/><path d="M6792 4138c-11-29-90-233-176-452-86-220-156-404-156-408 0-5 46-7 102-6l103 3 36 1e2 36 1e2h179 178l39-102 40-103h103c57 0 104 3 104 8 0 4-81 211-181 460l-181 452h-103-104l-19-52zm176-328c28-74 53-143 57-152 7-17-2-18-109-18-64 0-116 1-116 3 0 14 112 309 115 305 2-2 26-64 53-138z"/><path d="M9e2 2194v-466l243 4c275 5 316 14 399 88 174 153 186 548 22 730-82 90-163 109-466 110H9e2v-466zm455 277c51-23 91-69 107-124 19-65 16-261-5-323-19-55-56-97-1e2-113-16-6-80-11-143-11h-114v295 295h108c82 0 116-5 147-19z"/><path d="M8290 2575v-85h90 90v85 85h-90-90v-85z"/><path d="M6818 2587l-88-52v-67-68h-40-40v-70-70h39 38l5-212c6-252 13-278 80-308 48-22 140-26 201-9 34 9 37 13 37 47 0 72-11 113-29 108-55-16-69-17-85-1-14 14-16 43-16 196v179h60 60v70 70h-60-60v120c0 66-3 120-7 119-5 0-47-24-95-52z"/><path d="M7958 2587l-88-51v-68-68h-40-40v-70-70h39 39l4-217c3-245 9-268 78-304 40-22 141-26 203-8l39 10-7 72c-4 40-9 74-10 75-2 2-19-1-39-8-26-8-41-8-56 0-19 10-20 19-20 195v185h60 60v70 70h-60-60v120c0 66-3 120-7 120-5-1-47-24-95-53z"/><path d="M2013 2402c-151-54-227-166-227-332 1-206 121-337 320-348 157-9 267 51 334 182 33 64 35 74 35 165-1 82-4 104-26 151-37 79-81 125-156 162-83 41-198 49-280 20zm196-160c61-45 90-128 76-215-10-56-28-89-65-121-61-51-132-47-191 12-91 91-65 289 45 338 39 18 101 11 135-14z"/><path d="M2773 2402c-89-32-143-84-180-173-14-34-18-71-18-164 0-111 2-124 28-177 55-111 153-168 291-168 137 0 220 45 273 148 49 95 48 97-56 114l-89 14-11-36c-15-51-51-81-103-87-94-9-148 64-148 202 0 134 44 195 139 195 46 0 95-35 105-75 4-14 12-25 19-24 27 1 158 27 163 32 10 10-15 73-46 115-44 61-122 95-229 99-65 3-99-1-138-15z"/><path d="M4375 2408c-16-6-48-24-70-40l-40-29-3 31-3 30h-90-89v-335-335h95 95v203c0 111 4 219 9 240 24 102 152 141 191 59 9-18 14-103 18-264l5-238h87 88l4 223c3 189 6 227 21 254 38 70 120 90 163 39 24-27 24-29 24-272v-244h95 95v251c0 287-6 325-60 379-83 83-254 77-338-13l-23-24-37 37c-55 55-158 76-237 48z"/><path d="M5389 2404c-59-18-133-83-164-144s-48-168-39-245c14-127 67-215 158-263 46-25 61-27 161-27s115 2 161 27c70 37 144 128 131 162-3 7-42 18-88 25-78 12-85 12-94-5-26-47-63-74-102-74-68 0-118 45-137 123l-6 27h220 220v58c0 125-48 239-122 293-78 56-2e2 74-299 43zm178-150c29-18 49-51 58-91l7-33h-126-126v25c0 94 108 151 187 99z"/><path d="M6241 2406c-24-8-61-29-82-46l-39-31v36 35h-90-90v-335-335h94 95l3 223c4 258 8 275 84 309 54 23 91 18 125-18 24-25 24-28 27-270l3-244h95 95l-3 268c-3 257-4 269-26 315-33 65-90 99-180 103-40 2-84-2-111-10z"/><path d="M7292 2405c-81-23-130-67-157-144-11-31-11-41-2-41 7 0 45-6 85-14l73-14 15 30c20 40 73 61 129 52 50-7 72-27 81-71 7-35 18-30-156-69-202-46-250-89-250-221 0-42 6-67 25-99 63-107 255-127 371-39l32 24 6-34 7-35h96c87 0 94 2 88 18-30 71-35 115-35 296-1 264-11 298-104 345-62 31-221 39-304 16zm225-416c-4-49-11-67-33-90-69-72-173-58-190 27-10 53 23 74 181 112 22 6 42 10 44 11s1-26-2-60z"/><path d="M8836 2404c-167-53-255-209-226-397 19-127 75-206 180-256 48-23 67-26 160-26 91 0 112 3 155 24 59 30 126 94 154 149 70 138 39 341-68 434-87 77-242 108-355 72zm161-145c102-38 146-212 80-311-87-128-244-90-277 67s75 290 197 244z"/><path d="M9715 2404c-22-8-57-28-77-45l-38-30v36 35h-90-90v-335-335h94 95l3 223c3 257 8 275 83 308 52 23 94 17 127-18 23-24 23-29 26-269l3-244h95 96l-4 268c-3 264-3 268-28 317-20 38-37 55-75 74-60 31-160 38-220 15z"/><path d="M3312 2138c4-292 8-309 71-365 48-42 97-56 176-51 71 5 120 25 164 66l27 26v-42-42h90 90v335 335h-94-95l-3-223c-3-193-5-227-21-250-24-36-59-58-105-64-33-4-44-1-73 25l-34 30-3 241-3 241h-95-96l4-262z"/><path d="M8290 2065v-335h90 90v335 335h-90-90v-335z"/></g></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script src=/js/lunr.min.js?1657203542></script><script src=/js/auto-complete.js?1657203542></script><script>var index_url="/index.json",root_url="/",baseUri=root_url.replace(/\/$/,'')</script><script src=/js/search.js?1657203542></script></div><div id=homelinks><ul><li><a class=padding href=/><i class="fas fa-home"></i> Home</a></li></ul></div><div class=highlightable><ul class=topics><li data-nav-id=/getting-started/ title="Getting Started" class=dd-item><a href=/getting-started/>Getting Started</a><ul><li data-nav-id=/getting-started/protocol/ title="TRISA Protocol" class=dd-item><a href=/getting-started/protocol/>TRISA Protocol</a></li><li data-nav-id=/getting-started/api/ title="TRISA API" class=dd-item><a href=/getting-started/api/>TRISA API</a></li><li data-nav-id=/getting-started/errors/ title="TRISA Errors and Rejections" class=dd-item><a href=/getting-started/errors/>TRISA Errors and Rejections</a></li></ul></li><li data-nav-id=/joining-trisa/ title="Joining TRISA" class=dd-item><a href=/joining-trisa/>Joining TRISA</a><ul><li data-nav-id=/joining-trisa/registration/ title=Registration class=dd-item><a href=/joining-trisa/registration/>Registration</a></li><li data-nav-id=/joining-trisa/trixo/ title="TRIXO Form" class=dd-item><a href=/joining-trisa/trixo/>TRIXO Form</a></li><li data-nav-id=/joining-trisa/pkcs12/ title="Anatomy of a PKCS12 file" class=dd-item><a href=/joining-trisa/pkcs12/>Anatomy of a PKCS12 file</a></li><li data-nav-id=/joining-trisa/ca/ title="Certificate Authority" class=dd-item><a href=/joining-trisa/ca/>Certificate Authority</a></li></ul></li><li data-nav-id=/secure-envelopes/ title="Secure Envelopes" class=dd-item><a href=/secure-envelopes/>Secure Envelopes</a><ul></ul></li><li data-nav-id=/data-payloads/ title="Data Payloads" class=dd-item><a href=/data-payloads/>Data Payloads</a><ul></ul></li><li data-nav-id=/ivms/ title="Working with IVMS101" class=dd-item><a href=/ivms/>Working with IVMS101</a><ul></ul></li><li data-nav-id=/testnet/ title=TestNet class="dd-item parent"><a href=/testnet/>TestNet</a><ul><li data-nav-id=/testnet/rvasps/ title="Robot VASPs" class=dd-item><a href=/testnet/rvasps/>Robot VASPs</a></li><li data-nav-id=/testnet/trisa-cli/ title="TRISA CLI" class="dd-item active"><a href=/testnet/trisa-cli/>TRISA CLI</a></li><li data-nav-id=/testnet/certs-cli/ title="Creating Test Certificates" class=dd-item><a href=/testnet/certs-cli/>Creating Test Certificates</a></li></ul></li><li data-nav-id=/gds/ title="Directory Service" class=dd-item><a href=/gds/>Directory Service</a><ul><li data-nav-id=/gds/api/ title="Using the GDS API" class=dd-item><a href=/gds/api/>Using the GDS API</a></li><li data-nav-id=/gds/members/ title="Accessing Members" class=dd-item><a href=/gds/members/>Accessing Members</a></li></ul></li><li data-nav-id=/contributing/ title=Contributing class=dd-item><a href=/contributing/>Contributing</a><ul><li data-nav-id=/contributing/how-to-contribute/ title="How to Contribute" class=dd-item><a href=/contributing/how-to-contribute/>How to Contribute</a></li><li data-nav-id=/contributing/license/ title=License class=dd-item><a href=/contributing/license/>License</a></li></ul></li><li data-nav-id=/reference/ title=Reference class=dd-item><a href=/reference/>Reference</a><ul><li data-nav-id=/reference/faq/ title=FAQ class=dd-item><a href=/reference/faq/>FAQ</a></li><li data-nav-id=/reference/glossary/ title=Glossary class=dd-item><a href=/reference/glossary/>Glossary</a></li><li data-nav-id=/reference/best-practices/ title="Best Practices" class=dd-item><a href=/reference/best-practices/>Best Practices</a></li></ul></li></ul><div id=shortcuts><div class=nav-title></div><ul><li><a class=padding href=https://github.com/trisacrypto/trisa><i class="fab fa-fw fa-github"></i> Version v1beta1</a></li><li><a class=padding href=https://pkg.go.dev/github.com/trisacrypto/trisa/pkg><i class="fas fa-book"></i> TRISA API Documentation</a></li></ul></div><div id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=https://trisa.dev/testnet/trisa-cli/ selected>English</option></select><svg id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li></ul></div><div id=footer><p>Built with <a href=https://github.com/McShelby/hugo-theme-relearn><i class="fas fa-heart"></i></a> by <a href=https://gohugo.io/>Hugo</a></p></div></div></nav><div id=body><div id=overlay></div><div class="padding highlightable"><div id=top-bar><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3"><a itemprop=item href=/><span itemprop=name>Home</span></a> ></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="2"><a itemprop=item href=/testnet/><span itemprop=name>TestNet</span></a> ></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="1"><a itemprop=item href=/testnet/trisa-cli/ aria-disabled=true><span itemprop=name>TRISA CLI</span></a></li></ol></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#configuration>Configuration</a></li><li><a href=#creating-secure-envelopes>Creating Secure Envelopes</a></li><li><a href=#sealing>Sealing</a></li><li><a href=#opening>Opening</a></li><li><a href=#interacting-with-trisa-peers>Interacting with TRISA Peers</a><ul><li><a href=#transfers>Transfers</a></li><li><a href=#key-exchanges>Key Exchanges</a></li><li><a href=#address-confirmation>Address Confirmation</a></li><li><a href=#health-checks>Health Checks</a></li></ul></li><li><a href=#interacting-with-the-gds>Interacting with the GDS</a><ul><li><a href=#lookup>Lookup</a></li><li><a href=#search>Search</a></li></ul></li><li><a href=#guided-walkthrough>Guided Walkthrough</a></li></ul></nav></div></div></div><div id=head-tags></div><main id=body-inner><h1>TRISA CLI</h1><p>The TRISA command line client is a utility that assists TRISA integrators and developers testing their TRISA service. Advanced users may also use the TRISA client to execute TRISA requests for compliance purposes, although this is not recommended for extensive use. To install the latest version of the TRISA CLI, you must have <a href=https://go.dev/doc/install>Go installed</a> on your computer. The following command will install the latest version of the CLI:</p><pre><code>$ go install github.com/trisacrypto/trisa/cmd/trisa@main
</code></pre><div class="notices note"><div class=label>Note</div><p>We are currently working on a release mechanism that will automatically build the CLI for a variety of platforms so that in the future you will not need to have Go installed.
Stay tuned!</p></div><h2 id=configuration>Configuration</h2><p>Before you can start using the TRISA CLI, you must first configure your environment to ensure that you can successfully connect to a remote peer or the directory service.</p><p><strong>Prerequisites</strong>:</p><ol><li>The <code>trisa</code> command installed and on your <code>$PATH</code></li><li>Your <a href=/joining-trisa/registration/>testnet certificates</a> that include both the trust chain and private key.</li></ol><p>The TRISA CLI command is configured via flags specified for each command or by setting environment variables in your shell with the configuration. The CLI also supports the use of <a href=https://platform.sh/blog/2021/we-need-to-talk-about-the-env/>.env</a> files in the current working directory for configuration. To see what CLI flags should be specified use <code>trisa --help</code>. An example <code>.env</code> configuration file is as follows:</p><div class=highlight><pre class=chroma><code class=language-ini data-lang=ini><span class=c1># The endpoint to the TRISA node that you&#39;d like to connect to. The endpoint can be</span>
<span class=c1># found using the directory service lookup command.</span>
<span class=na>TRISA_ENDPOINT</span><span class=o>=</span><span class=s>example.com:443</span>

<span class=c1># Directory service you&#39;d like to connect to. You can specify a short name such as</span>
<span class=c1># &#34;testnet&#34; or &#34;mainnet&#34; or the endpoint of the directory service to connect to. The</span>
<span class=c1># configured directory is trisatest.net by default.</span>
<span class=na>TRISA_DIRECTORY</span><span class=o>=</span><span class=s>testnet</span>

<span class=c1># Path to your TRISA identity certificates that include the private key. This can be the</span>
<span class=c1># original .zip file sent by Sectigo or the unzipped .p12 file; in which case the</span>
<span class=c1># PKCS12 password must also be supplied. If you&#39;ve decrypted it manually it should be in</span>
<span class=c1># PEM encoded format with the .pem or .crt extension.</span>
<span class=na>TRISA_CERTS</span><span class=o>=</span><span class=s>path/to/certs.pem</span>

<span class=c1># If you&#39;ve split your certs into the public trust chain without private keys and a</span>
<span class=c1># private key file, then specify the path to the trust chain (optional).</span>
<span class=na>TRISA_TRUST_CHAIN</span><span class=o>=</span><span class=s>path/to/chain.pem</span>

<span class=c1># If the certs are PKCS12 encrypted then specify the password for decryption (optional).</span>
<span class=na>TRISA_CERTS_PASSWORD</span><span class=o>=</span><span class=s>supersecret</span>
</code></pre></div><p>The simplest way to get started with TRISA is to copy and paste the above snippet into a <code>.env</code> file in your current directory, then modifying the values as necessary.</p><h2 id=creating-secure-envelopes>Creating Secure Envelopes</h2><p>The first step when using the TRISA CLI is to create some payload data that can be sealed inside of secure envelopes for TRISA envelopes. At a minimum, there are two JSON files that you need to create or provide for the payload:</p><ol><li>An <em>identity</em> payload containing <a href=https://github.com/trisacrypto/trisa/blob/347f88d55df4d4e0167ad4e005721b638991ecef/proto/ivms101/identity.proto#L46-L53>IVMS 101</a> data.</li><li>A <em>transaction</em> payload containing a <a href=https://github.com/trisacrypto/trisa/blob/347f88d55df4d4e0167ad4e005721b638991ecef/proto/trisa/data/generic/v1beta1/transaction.proto#L11>Transaction</a> or <a href=https://github.com/trisacrypto/trisa/blob/347f88d55df4d4e0167ad4e005721b638991ecef/proto/trisa/data/generic/v1beta1/transaction.proto#L30>Pending</a> message.</li></ol><p>The identity payload is the compliance information required for the transfer and the transaction payload is used to identify the transaction on the chain and associate it with the identity information. For ease of data entry, these files may be specified as JSON files and the protocol buffer payload created using the <code>trisa make</code> command.</p><pre><code>$ trisa make -i identity.json -t transaction.json -o envelope.json
</code></pre><p>With no other arguments, this command creates an unsealed envelope that has a random envelope ID, the current time as the sent at timestamp, and no received at timestamp in the payload. The documentation refers to this kind of secure envelope as a &ldquo;payload template&rdquo; in the rest of the documentation because it can be loaded by the <code>trisa seal</code> or <code>trisa transfer</code> commands to update the envelope ID, timestamps, before sealing the envelope with the public keys of the recipient.</p><p>To create a complete envelope or a fully sealed envelope, simply specify the public sealing key with the <code>-seal</code> flag as well as any additional metadata you&rsquo;d like to supply on the envelope such as the envelope ID (see <code>trisa make --help</code> for more details).</p><h2 id=sealing>Sealing</h2><p>To seal an envelope you must have the public keys of the recipient, see <a href=#key-exchanges>the key exchanges section</a> for more detail on how to retrieve the public sealing key of a remote peer. Once you&rsquo;ve exchanged keys and saved them to disk, you can seal an unsealed envelope with the following command:</p><pre><code>$ trisa seal -in unsealed_envelope.json -out sealed_evelope.json -seal public.pem
</code></pre><p>Once the envelope has been sealed, only the recipient with the private key counterpart to the public key used to seal the envelope can open the secure envelope.</p><p>While sealing the envelope you also have the opportunity to update the envelope, e.g. to mark the received at timestamp or set a different envelope ID to create a new transfer:</p><pre><code>$ trisa seal -in envelope.json -out sealed.json -seal public.pem -received-at now
</code></pre><p>Another common workflow is to generate an error envelope with the same ID as an incoming envelope. Error envelopes do not require any cryptography, so the public key is not required:</p><pre><code>$ trisa seal -in envelope.json -error-code COMPLIANCE_CHECK_FAIL -error-message &quot;sanctioned entity&quot;
</code></pre><h2 id=opening>Opening</h2><p>By default the <code>trisa open</code> command is used to unseal an envelope and save it as an unsealed envelope for further processing. This command can also be used to extract the payload or check if an incoming envelope has an error on it. To extract an unsealed envelope and save it to disk:</p><pre><code>$ trisa open -in envelope.json -out unsealed_envelope.json -key private.pem
</code></pre><p>If you add the <code>-payload</code> flag, then the payload will be decrypted and saved to disk; adding the <code>-error</code> flag will extract an error and save it to disk. If the <code>envelope.json</code> is an unsealed envelope, then the <code>-key</code> flag can be omitted. If the <code>-out</code> flag is ommitted, the contents will be printed to disk. For example to simply view the payload of a sealed envelope:</p><pre><code>$ trisa open -in envelope.json -key private.pem -payload
</code></pre><p>Or to view an error on the envelope:</p><pre><code>$ trisa open -in envelope.json -error
</code></pre><p>Note that no private key is required for errors since errors are not encrypted.</p><div class="notices tip"><div class=label>Tip</div><p>By default a key exchange will use your TRISA identity certs as the sealing key, however the <code>trisa open</code> command won&rsquo;t automatically use your TRISA identity certs for unsealing the envelope. If you used the default key exchange then you can take advantage of the environment configuration to pass the path to your identity certs that contain your private key as follows:</p><pre><code>$ trisa open -in envelope.json -key $TRISA_CERTS
</code></pre></div><h2 id=interacting-with-trisa-peers>Interacting with TRISA Peers</h2><p>The primary use of the <code>trisa</code> CLI is to execute TRISA RPC requests to a TRISA node. A general workflow is as follows:</p><ol><li>Identify the peer endpoint using the Directory Service lookup or search functionality.</li><li>Create a secure envelope or payload template to prepare to send to the remote peer.</li><li>Perform a key exchange with the remote peer and save the sealing keys.</li><li>Seal the secure envelope or payload template with the remote peer&rsquo;s sealing keys.</li><li>Execute a transfer and save the response envelope.</li></ol><p>This workflow generally mirrors the workflow of live TRISA compliance operations, though many of the steps are manual to facilitate integration and development.</p><h3 id=transfers>Transfers</h3><p>Send a secure envelope to the remote TRISA peer and receive a secure envelope in exchange. Transfers are the central compliance exchange mechanism in the TRISA protocol. If you have already created and sealed an envelope, saving it to <code>outgoing.json</code> you can transfer it as follows:</p><pre><code>$ trisa transfer -i outgoing.json -o response.json
</code></pre><p>This will execute the TRISA transfer and save the response, including TRISA error envelopes, to disk at the specified path. If the extension of the output path is <code>.json</code> then the envelope is marshaled to <code>.json</code> format, if it is the <code>.pb</code> extension it will be saved as a raw protocol buffer. If the <code>-o</code> flag is not supplied, then the JSON response will be printed to the command line. If you would like the decrypted payload printed, then you must provide the private sealing key:</p><pre><code>$ trisa transfer -i outgoing.json -k private.pem
</code></pre><p>If both an output path and the private key are provided then a JSON file is produced with the unsealed envelope that can be read using the <code>open</code> command or resent using the <code>seal</code> command.</p><p>You can also use a secure envelope payload template to seal and transfer an envelope in one step instead of using the intermediate <code>seal</code> command:</p><pre><code>$ trisa transfer -i outgoing.json -s public_sealing_key.pem
</code></pre><p>See <a href=#sealing>sealing secure envelopes</a> for more information on the command line arguments that can be used to adapt secure envelopes before sending them.</p><p>If you would like to send an error-only secure envelope to the recipient, then you must supply the envelope ID, error code, and error message as follows:</p><pre><code>$ trisa transfer -I envelope-id-foo -C COMPLIANCE_CHECK_FAIL -E &quot;something went wrong&quot;
</code></pre><p>Note that sending an error-only secure envelope is usually a response to an incoming message. This mechanism is used primarily to test a server&rsquo;s handling of an asynchronous transfer workflow.</p><div class="notices note"><div class=label>Note</div><p>The TRISA CLI command currently does not implement the <code>TRISANetwork/TransferStream</code> birdirectional streaming RPC and does not have plans to implement this in the CLI. If you would like an implementation of streaming from the command line, please open an issue on our <a href=https://github.com/trisacrypto/trisa/issues>GitHub repository</a>.</p></div><h3 id=key-exchanges>Key Exchanges</h3><p>Send a key exchange request to get the public sealing key of the node. Key management is a somewhat complex topic, and the TRISA CLI attempts to do the simplest possible thing to enable testing and development. A key exchange requires you to send your public sealing keys to the remote node, and they will return keys to you. Prior to a transfer, a key exchange must be completed so that you have the sealing keys to create a secure envelope and so that the remote has your public keys to send a response.</p><p>By default, the TRISA CLI will simply use your TRISA mTLS identity certificates as the keys for a key exchange. The simplest exchange is therefore:</p><pre><code>$ trisa exchange -o peer_sealing_keys.pem
</code></pre><p>The <code>-o</code> flag saves the keys to disk at the specified path, so that you can use the keys later on to make secure envelopes or conduct transfers. If the <code>-o</code> flag is ommitted, the JSON data of the response, an <code>SigningKey</code> protocol buffer message will be printed to <code>stdout</code>. There are several formats that the keys can be saved in: a path with a <code>.json</code> or <code>.pb</code> extension will save the protocol buffer message to disk in the specified format; a path with a <code>.pem</code> or <code>.crt</code> extension will save the keys as PEM encoded public key.</p><p>To send alternative keys to the remote peer in a key exchange, you may use the <code>-i</code> flag to specify the path of keys to send. If the input path ends in <code>.json</code> or <code>.pb</code> it is parsed as a <code>SigningKey</code> protocol buffer message in JSON format or raw protobuf format respectively. If the input path ends in <code>.pem</code> or <code>.crt</code> it is parsed as a PEM encoded public key or x.509 certificate. Note that the PEM encoded format, the first <code>PUBLIC KEY</code> or <code>CERTIFICATE</code> block that is found is used for parsing.</p><p>To generate your own RSA keys to send to the remote server for key exchange, use the following commands:</p><pre><code>$ openssl genrsa -out private.pem 4096
$ openssl rsa -in private.pem -pubout -out public.pem
</code></pre><p>This will create two files, <code>private.pem</code> that contains your private keys and <code>public.pem</code> which contains your public keys. Send the public key to the remote TRISA peer as follows:</p><pre><code>$ trisa exchange -i public.pem -o peer_sealing_keys.pem
</code></pre><p>Ensure that you keep the <code>private.pem</code> file so that you can decrypt transfers that follow; it is likely that the remote TRISA node will use the key you just exchanged in sending outgoing transfers and preparing responses to your transfers. The only way to decrypt that data is with the private key!</p><h3 id=address-confirmation>Address Confirmation</h3><div class="notices warning"><div class=label>Warning</div><p>Address confirmation has not yet been fully defined by the TRISA working group. The TRISA technical subcommittee is currently working on the Address Confirmation protocol, so stay tuned for more information!</p></div><h3 id=health-checks>Health Checks</h3><p>Send a health check request to check the status of the TRISA node.</p><p>The health check RPC is primariliy for the directory service to monitor if the TRISA network is online, however it is also useful for debugging or diagnosing connection issues (e.g. is the remote peer offline or are my certificates invalid). A simple health check request is as follows:</p><pre><code>$ trisa status
</code></pre><p>Use the <code>--insecure</code> flag to connect without mTLS credentials, though not all TRISA peers will support an insecure status check.</p><h2 id=interacting-with-the-gds>Interacting with the GDS</h2><p>The TRISA CLI supports some basic interactions with the TRISA Global Directory Service (GDS) based on your initial configuration.</p><h3 id=lookup>Lookup</h3><p>Lookup a TRISA VASP by common name or VASP ID. The following requests will lookup Alice on the TestNet by both common name and ID:</p><pre><code>$ trisa lookup -n api.alice.vaspbot.net
</code></pre><pre><code>$ trisa lookup -i 7a96ca2c-2818-4106-932e-1bcfd743b04c
</code></pre><p>Lookups also support the registered directory argument if looking up a VASP that is a member of the network but was issued certificates from a different directory service. If omitted, by default the directory service will lookup the VASP record as though it was the registered directory.</p><h3 id=search>Search</h3><p>Search for a TRISA VASP by name or by website. You can specify multiple names and websites to expand your search. E.g. to search for &ldquo;Alice&rdquo; and &ldquo;Bob&rdquo; on the TestNet:</p><pre><code>$ trisa search -n alice -n bob
</code></pre><p>If this returns too many results you may specify either category or country filters for the results. Country filters are inclusive and should be ISO Alpha-2 country codes:</p><pre><code>$ trisa search -n alice -n bob -c US -c SG
</code></pre><div class="notices tip"><div class=label>Tip</div><p>Categories are case sensitive and websites must be full URLs for the search to work. If you&rsquo;re not getting any results for a website search, try adding the <code>http://</code> prefix or removing any paths from the URL. If you&rsquo;re not getting any results for the name, try using a prefix of the name that is greater than 3 characters.</p></div><p>Categories that may be helpful in filtering:</p><table><thead><tr><th>VASP Categories</th><th>Business Categories</th></tr></thead><tbody><tr><td>Exchange</td><td>PRIVATE_ORGANIZATION</td></tr><tr><td>DEX</td><td>GOVERNMENT_ENTITY</td></tr><tr><td>P2P</td><td>BUSINESS_ENTITY</td></tr><tr><td>Kiosk</td><td>NON_COMMERCIAL_ENTITY</td></tr><tr><td>Custodian</td><td></td></tr><tr><td>OTC</td><td></td></tr><tr><td>Fund</td><td></td></tr><tr><td>Project</td><td></td></tr><tr><td>Gambling</td><td></td></tr><tr><td>Miner</td><td></td></tr><tr><td>Mixer</td><td></td></tr><tr><td>Individual</td><td></td></tr><tr><td>Other</td><td></td></tr></tbody></table><h2 id=guided-walkthrough>Guided Walkthrough</h2><p>This section contains a guided walkthrough of an interaction with the <a href=/testnet/rvasps/>Alice rVASP</a> using the CLI. To complete this walkthrough you will need TRISA TestNet certificates issued by the TRISA Global Directory Service, the <code>trisa</code> CLI application installed and configured with those certs as discussed at the top of this guide. Ensure that the <code>$TRISA_DIRECTORY</code> environment variable is set to <code>testnet</code>.</p><p>First, perform a TRISA Global Directory search for the Alice VASP:</p><pre><code>$ trisa search -n alice
{
  &quot;error&quot;:  null,
  &quot;results&quot;:  [
    {
      &quot;id&quot;:  &quot;7a96ca2c-2818-4106-932e-1bcfd743b04c&quot;,
      &quot;registered_directory&quot;:  &quot;trisatest.net&quot;,
      &quot;common_name&quot;:  &quot;api.alice.vaspbot.net&quot;,
      &quot;endpoint&quot;:  &quot;api.alice.vaspbot.net:443&quot;
    }
  ]
}
</code></pre><p>To get more information about Alice VASP, lookup the record in the GDS:</p><pre><code>$ trisa lookup -cn api.alice.vaspbot.net
{
    &quot;name&quot;:  &quot;AliceCoin&quot;,
    &quot;country&quot;:  &quot;US&quot;,
    [...]
}
</code></pre><p>The rest of the interactions will be with the Alice rVASP, so ensure that the <code>$TRISA_ENDPOINT</code> environment variable is set to <code>api.alice.vaspbot.net:443</code> (or whatever endpoint was returned by the directory service).</p><div class="notices tip"><div class=label>Tip</div><p>Managing the environment variables for configuring the <code>trisa</code> CLI can be done with a <code>.env</code> file in your current working directory.</p></div><p>Download a copy of the following data for the payload:</p><ul><li><a href=https://gist.github.com/bbengfort/be1f255756834268cc006c31d088eb3b><code>identity.json</code></a></li><li><a href=https://gist.github.com/bbengfort/b1b2a883ca61da95d84019310cbfd091><code>transaction.json</code></a></li></ul><p>This contains payload information as though we are sending Alice a compliance information transfer from a VASP named &ldquo;MyVASP&rdquo;.</p><p>Build the payload template:</p><pre><code>$ trisa make -i identity.json -t transaction.json -o unsealed_envelope.json
</code></pre><p>This should create an unsealed envelope with the payload data, the sent at timestamp set to now and a random envelope ID. To view the payload in the unsealed envelope:</p><pre><code>$ trisa open -i unsealed_envelope.json -payload
</code></pre><p>Conduct a key exchange with Alice to get Alice&rsquo;s public keys to seal the envelope:</p><pre><code>$ trisa exchange -o alice.pem
</code></pre><p>You can then seal the envelope so that only Alice can open it:</p><pre><code>$ trisa seal -i unsealed_envelope.json -s alice.pem -o outgoing.json
</code></pre><p>You can now make the transfer to Alice:</p><pre><code>$ trisa transfer -i outgoing.json -o incoming.json
</code></pre><p>View the payload from Alice using your private key to decrypt the message. Note that you&rsquo;ll need to source the <code>.env</code> file for the following command to work if you&rsquo;re using the <code>.env</code> file for configuration:</p><pre><code>$ source .env
$ trisa open -i incoming.json -k $TRISA_CERTS -payload
</code></pre><div class="notices warning"><div class=label>Warning</div><p>If you receive the following error when running the above command:</p><pre><code>envelope in unhandled state corrupted
</code></pre><p>It means that the rVASP is running an older TRISA version. Please contact the TRISA admins if this is the rVASP running in TestNet or use the latest docker image if you&rsquo;re running an rVASP in your local environment.</p></div><footer class=footline></footer></main></div><div id=navigation><a class="nav nav-prev" href=/testnet/rvasps/ title="Robot VASPs"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/testnet/certs-cli/ title="Creating Test Certificates"><i class="fa fa-chevron-right"></i></a></div></div><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1657203542></script><script src=/js/perfect-scrollbar.min.js?1657203542></script><script src=/js/perfect-scrollbar.jquery.min.js?1657203542></script><script src=/js/jquery.svg.pan.zoom.js?1657203542></script><script src=/js/featherlight.min.js?1657203542></script><script src=/js/modernizr.custom-3.6.0.js?1657203542></script><script src=/js/mermaid.min.js?1657203542></script><script>typeof mermaid!='undefined'&&mermaid.mermaidAPI.initialize(Object.assign({securityLevel:"antiscript"},JSON.parse('{ "startOnLoad": true }'),{startOnLoad:!1}))</script><script src=/js/relearn.js?1657203542></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-F9T1H8EJJS"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-F9T1H8EJJS')</script></body></html>