<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.83.1"><meta name=description content="Directory Service interactions with the Sectigo CA API"><link rel=icon href=/images/favicon.png type=image/png><title>Sectigo :: TRISA Documentation</title><link href=/css/nucleus.css?1634142511 rel=stylesheet><link href=/css/fontawesome-all.min.css?1634142511 rel=stylesheet><link href=/css/featherlight.min.css?1634142511 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1634142511 rel=stylesheet><link href=/css/auto-complete.css?1634142511 rel=stylesheet><link href=/css/theme.css?1634142511 rel=stylesheet><link href=/css/theme-blue.css?1634142511 rel=stylesheet><link href=/css/variant.css?1634142511 rel=stylesheet><link href=/css/print.css?1634142511 rel=stylesheet media=print><script src=/js/jquery.min.js?1634142511></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}:not(pre)>code+span.copy-to-clipboard{display:none}</style></head><body data-url=/gds/sectigo/><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href=/ style="color:#3d414d;font-family:novacento sans wide,helvetica,tahoma,geneva,arial,sans-serif;font-size:30px;font-weight:700;margin-top:-2px"><img src=../../images/trisa-docs-logo.png></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script src=/js/lunr.min.js?1634142511></script><script src=/js/auto-complete.js?1634142511></script><script>var index_url="/index.json",root_url="/",baseUri=root_url.replace(/\/$/,'')</script><script src=/js/search.js?1634142511></script></div><div id=homelinks><ul><li><a class=padding href=/><i class="fas fa-home"></i> Home</a></li></ul></div><div class=highlightable><ul class=topics><li data-nav-id=/integration/ title="Integration Overview" class=dd-item><a href=/integration/>Integration Overview</a><ul></ul></li><li data-nav-id=/testnet/ title=TestNet class=dd-item><a href=/testnet/>TestNet</a><ul><li data-nav-id=/testnet/rvasps/ title="Robot VASPs" class=dd-item><a href=/testnet/rvasps/>Robot VASPs</a></li></ul></li><li data-nav-id=/gds/ title="Directory Service" class="dd-item parent"><a href=/gds/>Directory Service</a><ul><li data-nav-id=/gds/registration/ title=Registration class=dd-item><a href=/gds/registration/>Registration</a></li><li data-nav-id=/gds/sectigo/ title=Sectigo class="dd-item active"><a href=/gds/sectigo/>Sectigo</a></li></ul></li><li data-nav-id=/contributing/ title=Contributing class=dd-item><a href=/contributing/>Contributing</a><ul><li data-nav-id=/contributing/license/ title=License class=dd-item><a href=/contributing/license/>License</a></li></ul></li><li data-nav-id=/reference/ title=Reference class=dd-item><a href=/reference/>Reference</a><ul><li data-nav-id=/reference/faq/ title=FAQ class=dd-item><a href=/reference/faq/>FAQ</a></li><li data-nav-id=/reference/glossary/ title=Glossary class=dd-item><a href=/reference/glossary/>Glossary</a></li></ul></li></ul><div id=shortcuts><div class=nav-title></div><ul><li><a class=padding href=https://github.com/trisacrypto/trisa><i class="fab fa-fw fa-github"></i> Version v1beta1</a></li></ul></div><div id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=https://trisa.dev/gds/sectigo/ selected>English</option><option id=de value=https://trisa.dev/de/gds/sectigo/>Deutsch</option></select><svg id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li></ul></div><div id=footer><p>Built with <a href=https://github.com/McShelby/hugo-theme-relearn><i class="fas fa-heart"></i></a> by <a href=https://gohugo.io/>Hugo</a></p></div></div></nav><div id=body><div id=overlay></div><div class="padding highlightable"><div id=top-bar><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3"><a itemprop=item href=/><span itemprop=name>Home</span></a> ></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="2"><a itemprop=item href=/gds/><span itemprop=name>Directory Service</span></a> ></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="1"><a itemprop=item href=/gds/sectigo/ aria-disabled=true><span itemprop=name>Sectigo</span></a></li></ol></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#getting-started>Getting Started</a></li><li><a href=#authentication>Authentication</a></li><li><a href=#authorities-and-profiles>Authorities and Profiles</a></li><li><a href=#creating-certificates>Creating Certificates</a></li><li><a href=#uploading-a-csr>Uploading a CSR</a></li><li><a href=#managing-certificates>Managing Certificates</a></li></ul></nav></div></div></div><div id=head-tags></div><main id=body-inner><h1>Sectigo</h1><p><a href=https://pkg.go.dev/github.com/trisacrypto/directory/pkg/sectigo><img src=https://pkg.go.dev/badge/github.com/trisacrypto/directory/pkg/sectigo.svg alt="Go Reference"></a></p><p>The TRISA Directory Service issues certificates using the Sectigo Certificate Authority via its IoT Portal. Because the directory service must collect public key material in order to facilitate an initial trusted handshake for mTLS, it uses the Sectigo IoT Manager API as part of the VASP registration and verification process. The <code>github.com/trisacrypto/directory/pkg/sectigo</code> package is a Go library for interacting with the API, implementing the endpoints and methods required by the directory service. The TestNet also provides a command line utility for interacting with the API for administrative and debugging purposes. This documentation describes the command line utility, which also gives an overview of how to use the API directly to issue and revoke certificates.</p><p>Reference material:</p><ul><li><a href=https://pkg.go.dev/github.com/trisacrypto/directory/pkg/sectigo>Package Documentation</a></li><li><a href="https://support.sectigo.com/Com_KnowledgeDetailPage?Id=kA01N000000bvCJ">IoT Manager API Documentation</a></li><li><a href=https://iot.sectigo.com>IoT Manager Portal</a></li></ul><h2 id=getting-started>Getting Started</h2><p>To install the <code>sectigo</code> CLI utility, either download a pre-compiled binary from the <a href=https://github.com/trisacrypto/directory/releases>releases on GitHub</a> or install locally using:</p><pre><code>$ go get github.com/trisacrypto/directory/cmd/sectigo
</code></pre><p>This will add the <code>sectigo</code> command to your <code>$PATH</code>.</p><h2 id=authentication>Authentication</h2><p>The first step is authentication, you should set your username and password in the <code>$SECTIGO_USERNAME</code> and <code>$SECTIGO_PASSWORD</code> environment variables (alternatively you can pass them as parameters on the command line). To verify your authentication status you can use:</p><pre><code>$ sectigo auth
</code></pre><p>The API authenticates by username and password then returns acess and refresh tokens which are stored in a local cache file. To see where your cache is stored:</p><pre><code>$ sectigo auth --cache
</code></pre><p>If you&rsquo;d like to check your credentials state, e.g. if the access tokens are valid, refreshable, or expired, use:</p><pre><code>$ sectigo auth --debug
</code></pre><h2 id=authorities-and-profiles>Authorities and Profiles</h2><p>To begin to interact with certificates you need to list the authorities and profiles that your user account has access to.</p><pre><code>$ sectigo authorities
[
  {
    &quot;id&quot;: 1,
    &quot;ecosystemId&quot;: 100,
    &quot;signerCertificateId&quot;: 0,
    &quot;ecosystemName&quot;: &quot;TRISA&quot;,
    &quot;balance&quot;: 10,
    &quot;enabled&quot;: true,
    &quot;profileId&quot;: 42,
    &quot;profileName&quot;: &quot;TRISA Profile&quot;
  }
]
</code></pre><p>The authority displays the methods and profiles that certificates are created under. Here the <code>profileId</code> field is very important for use in subsequent calls. You can also view how many licenses have been ordered/issued across all authorities as follows:</p><pre><code>$ sectigo licenses
{
  &quot;ordered&quot;: 2,
  &quot;issued&quot;: 2
}
</code></pre><p>To get detail information for a profile, use the profile ID with the following command:</p><pre><code>$ sectigo profiles -i 42
</code></pre><p>This will return the raw profile configuration. Before creating certificates with the authority, you&rsquo;ll need to know the required profile parameters:</p><pre><code>$ sectigo profile -i 42 --params
</code></pre><h2 id=creating-certificates>Creating Certificates</h2><p>You can request a certificate to be created with the <code>commonName</code> and <code>pkcs12Password</code> params as follows (note for profiles that require other params, you&rsquo;ll have to use the code base directly and implement your own method):</p><pre><code>$ sectigo create -a 42 -d example.com -p secrtpasswrd -b &quot;example.com certs&quot;
{
  &quot;batchId&quot;: 24,
  &quot;orderNumber&quot;: 1024,
  &quot;creationDate&quot;: &quot;2020-12-10T16:35:32.805+0000&quot;,
  &quot;profile&quot;: &quot;TRISA Profile&quot;,
  &quot;size&quot;: 1,
  &quot;status&quot;: &quot;CREATED&quot;,
  &quot;active&quot;: false,
  &quot;batchName&quot;: &quot;example.com certs&quot;,
  &quot;rejectReason&quot;: &quot;&quot;,
  &quot;generatorParametersValues&quot;: null,
  &quot;userId&quot;: 10,
  &quot;downloadable&quot;: true,
  &quot;rejectable&quot;: true
}
</code></pre><p>The <code>-a</code> flag specifies the authority, but should be a profile id. The domain must be a valid domain. If you don&rsquo;t specify a password, one is generated for you and printed on the CLI before exit. The <code>-b</code> flag gives a human readable name for the batch creation. The return data shows detail about the batch certificate job that was created; you can fetch the data to keep checking on the status as follows:</p><pre><code>$ sectigo batches -i 24
</code></pre><p>You can also get processing information for the batch:</p><pre><code>$ sectigo batches -i 24 --status
</code></pre><p>Once the batch is created, it&rsquo;s time to download the certificates in a ZIP file:</p><pre><code>$ sectigo download -i 24 -o certs/
</code></pre><p>This will download the batch file (usually batchId.zip, 24.zip in this case) to the <code>certs/</code> directory. Unzip the certs then decrypt the .pem file as follows:</p><pre><code>$ unzip certs/24.zip
$ openssl pkcs12 -in certs/example.com.p12 -out certs/example.com.pem -nodes
</code></pre><p>For more on working with the PKCS12 file, see <a href=https://www.ssl.com/how-to/export-certificates-private-key-from-pkcs12-file-with-openssl/>Export Certificates and Private Key from a PKCS#12 File with OpenSSL</a>.</p><h2 id=uploading-a-csr>Uploading a CSR</h2><p>An alternative to certificate creation is to upload a certificate signing request (CSR). This mechanism is often preferable because it means that no private key material has to be transmitted accross the network and the private key can remain on secure hardware.</p><p>To generate a CSR using <code>openssl</code> on the command line, first create a configuration file named <code>trisa.conf</code> in your current working directory, replacing <code>example.com</code> with the domain you plan to host your TRISA endpoint on:</p><pre><code class=language-conf data-lang=conf>[req]
distinguished_name = dn_req
req_extensions = v3ext_req
prompt = no
default_bits = 4096
[dn_req]
CN = example.com
O = [Organization]
L = [City]
ST = [State or Province (fully spelled out, no abbreviations)]
C = [2 digit country code]
[v3ext_req]
basicConstraints = CA:FALSE
keyUsage = digitalSignature, keyEncipherment, nonRepudiation
extendedKeyUsage = clientAuth, serverAuth
subjectAltName = @alt_names
[alt_names]
DNS.1 = example.com
</code></pre><p>Please carefully fill out the configuration for your certificate, this information must be correct and cannot be changed without reissuing the certificate. Also make sure that there are no spaces after the entries in the configuration!</p><p>Then run the following command, replacing <code>example.com</code> with the domain name you will be using as your TRISA endpoint:</p><pre><code>$ openssl req -new -newkey rsa:4096 -nodes -sha384 -config trisa.conf \
  -keyout example.com.key -out example.com.csr
</code></pre><p>You can then upload the CSR using the CLI program as follows:</p><pre><code>$ sectigo upload -p 42 &lt;common_name&gt;.csr
{
  &quot;batchId&quot;: 24,
  &quot;orderNumber&quot;: 1024,
  &quot;creationDate&quot;: &quot;2020-12-10T16:35:32.805+0000&quot;,
  &quot;profile&quot;: &quot;TRISA Profile&quot;,
  &quot;size&quot;: 1,
  &quot;status&quot;: &quot;CREATED&quot;,
  &quot;active&quot;: false,
  &quot;batchName&quot;: &quot;example.com certs&quot;,
  &quot;rejectReason&quot;: &quot;&quot;,
  &quot;generatorParametersValues&quot;: null,
  &quot;userId&quot;: 10,
  &quot;downloadable&quot;: true,
  &quot;rejectable&quot;: true
}
</code></pre><p>The <code>-p</code> flag specifies the profile to use the CSR batch request with and must be a valid profileId. The uploaded CSRs can be a single text file with multiple CSRs in PEM form using standard BEGIN/END separators.</p><h2 id=managing-certificates>Managing Certificates</h2><p>You can search for a certificate by name or serial number, but mostly commonly you search by the domain or common name to get the serial number:</p><pre><code>$ sectigo find -n example.com
</code></pre><p>Once you&rsquo;ve obtained the serial number you can revoke the certificate as follows:</p><pre><code>$ sectigo revoke -p 42 -r &quot;cessation of operation&quot; -s 12345
</code></pre><p>This command expects the profile id that issued the certificate with the <code>-p</code> flag, an <a href=https://tools.ietf.org/html/rfc5280#section-5.3.1>RFC 5280 reason code</a> passed via the <code>-r</code> flag (unspecified by default), and the serial number of the certificate using the <code>-s</code> flag. If this command doesn&rsquo;t error, then the certificate has been successfully revoked.</p><p>The RFC 5280 reasons are:</p><ul><li>&ldquo;unspecified&rdquo;</li><li>&ldquo;keycompromise&rdquo;</li><li>&ldquo;ca compromise&rdquo;</li><li>&ldquo;affiliation changed&rdquo;</li><li>&ldquo;superseded&rdquo;</li><li>&ldquo;cessation of operation&rdquo;</li><li>&ldquo;certificate hold&rdquo;</li><li>&ldquo;remove from crl&rdquo;</li><li>&ldquo;privilege withdrawn&rdquo;</li><li>&ldquo;aa compromise&rdquo;</li></ul><p>Note that the reason is whitespace and case insensitive.</p><footer class=footline></footer></main></div><div id=navigation><a class="nav nav-prev" href=/gds/registration/ title=Registration><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/contributing/ title=Contributing><i class="fa fa-chevron-right"></i></a></div></div><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1634142511></script><script src=/js/perfect-scrollbar.min.js?1634142511></script><script src=/js/perfect-scrollbar.jquery.min.js?1634142511></script><script src=/js/jquery.svg.pan.zoom.js?1634142511></script><script src=/js/featherlight.min.js?1634142511></script><script src=/js/modernizr.custom-3.6.0.js?1634142511></script><script src=/js/mermaid.min.js?1634142511></script><script>typeof mermaid!='undefined'&&mermaid.mermaidAPI.initialize(Object.assign({securityLevel:"antiscript"},JSON.parse('{ "startOnLoad": true }'),{startOnLoad:!1}))</script><script src=/js/relearn.js?1634142511></script></body></html>